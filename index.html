<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>جامعة كلباء - دليل الأقسام</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { font-family: 'Cairo', sans-serif; }
    #map { height: 80vh; width: 100%; }
    ul { list-style: none; padding: 0; }
    li { cursor: pointer; padding: 5px; background: #fef3c7; margin: 3px 0; border-radius: 5px; }
    li:hover { background: #fde68a; }
  </style>
</head>
<body>

<h1>مرحبا بكم في جامعة كلباء</h1>
<p>يسرنا أن نقدم هذا الدليل لتسهيل الوصول إلى أقسام الجامعة بكل راحة وسهولة.</p>
<p>مبادرة من الطالبة: عايشه راشد الزعابي<br>رقم الجماعي: KB2410105</p>

<h2>الأقسام</h2>
<ul id="deptsList"></ul>

<div id="map"></div>

<footer>© 2025 جامعة كلباء</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const state = {
  depts: [
    {name: 'قسم التسجيل والقبول', lat: 25.1128, lng: 56.3255},
    {name: 'قسم المالية', lat: 25.1132, lng: 56.3262},
    {name: 'قسم شؤون الطلبة', lat: 25.1124, lng: 56.3249},
    {name: 'قسم الإدارة', lat: 25.1130, lng: 56.3250},
    {name: 'قسم الموارد البشرية', lat: 25.1126, lng: 56.3258},
    {name: 'قسم المكتبة', lat: 25.1122, lng: 56.3252},
    {name: 'قسم تكنولوجيا المعلومات', lat: 25.1129, lng: 56.3247}
  ],
  markers: {},
  polyline: null,
  userMarker: null,
  userCircle: null
};

const deptsList = document.getElementById('deptsList');
const map = L.map('map').setView([25.1122, 56.3245], 17);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '© OpenStreetMap'
}).addTo(map);

const entrance = [25.1120, 56.3245];
L.marker(entrance).addTo(map).bindPopup('بوابة الجامعة').openPopup();

state.depts.forEach((d,i)=>{
  const li = document.createElement('li');
  li.textContent = d.name;
  li.onclick = ()=> showRoute(i);
  deptsList.appendChild(li);
});

state.depts.forEach((d,i)=>{
  const marker = L.marker([d.lat,d.lng]).addTo(map).bindPopup(`${d.name}`);
  state.markers[i] = marker;
});

function showRoute(i){
  const d = state.depts[i];
  if(state.polyline){ map.removeLayer(state.polyline); }
  state.polyline = L.polyline([entrance, [d.lat,d.lng]], {color:'#8B4513', weight:5, opacity:0.7}).addTo(map);
  map.fitBounds(state.polyline.getBounds());
  state.markers[i].openPopup();
}

map.locate({watch: true, setView: true, maxZoom: 18});
map.on('locationfound', function(e){
  const radius = e.accuracy / 2;
  if(!state.userMarker){
    state.userMarker = L.marker(e.latlng).addTo(map).bindPopup('أنت هنا').openPopup();
  } else {
    state.userMarker.setLatLng(e.latlng);
  }
  if(!state.userCircle){
    state.userCircle = L.circle(e.latlng, radius).addTo(map);
  } else {
    state.userCircle.setLatLng(e.latlng).setRadius(radius);
  }
});
map.on('locationerror', function(e){ alert('تعذر الحصول على الموقع: ' + e.message); });
</script>

</body>
</html>